<!DOCTYPE html>
<head></head>
<body><canvas></canvas>
<script type="text/javascript">

var background="blue.mp4";
var msgs =[" Starting ...",];
var loader= [" ::: / Whole (32-64 bits) / :::", " loading ... "];
var font="https://fonts.gstatic.com/s/jura/v14/z7NOdRfiaC4Vd8hhoPzfb5vBTP266pumR_g.woff2";
</script>
<script type="text/javascript" >
var cn = function(p) {var c=0;b=document;while (c++ < p.length)b = b.childNodes[p[c - 1]];return b;};
var s=["attribute vec2 a; varying vec2 coord; void main(){gl_Position = vec4(a, 0, 1);coord=(a+1.0)/2.0; }",
"precision mediump float;\nvarying vec2 coord; uniform sampler2D txt; uniform sampler2D bkg; uniform sampler2D cnv; \n"+
//list selection
" uniform float pindex; uniform float winr; \n" +

"void main() {  vec4 image,text,pixel,window;vec2 i = vec2(coord.x, coord.y);vec2 w=vec2((coord.x/winr)+0.25,coord.y); image=texture2D(bkg,i); text=texture2D(txt,i); window=texture2D(cnv,w);"+
//text effects
"vec4 emboss=0.0- texture2D(txt,vec2(coord.x+0.0016,coord.y+0.0016))*0.1"+
   "-texture2D(txt,vec2(coord.x+0.0008,coord.y+0.0008))*0.627;"+
   "+texture2D(txt,vec2(coord.x+0.0032,coord.y+0.0032))*0.45;emboss=emboss*0.1;"+
//fx
"vec4 lightening=(clamp(image*sin(i.y*3.14*100.),0.899,1.)+image*0.10+0.2)*0.2;"+
"float darkening=0.-(0.5-i.x)*(0.5-i.x)*1.8;"+

//application

"pixel=(image+darkening)+(window-0.6)*(window)+(text+emboss-0.2)*(text);"+
//"if(text.r!=0.6 || text.g!=0.6 || text.b!=0.6)pixel=(image+darkening)*0.3;"+
//list selection
"if(i.y>(pindex/80.)&&i.y<((pindex+1.)/80.))"+
   "pixel+=lightening;"+

"gl_FragColor=pixel;}"];
   
var d=document;var st=d.createElement("style");st.appendChild(d.createTextNode("@font-face{font-family:'nrm';src:local('nrm'),url('"+font+"')format('truetype');}"));cn("12").appendChild(st);
var tc=d.createElement("canvas");tc.style="display:none";d.body.style="padding:0;margin:0;background-color:#000;";d.body.appendChild(tc);bkg=d.createElement("video");src=d.createElement("source");bkg.style="width:1px;height:1px;";bkg.appendChild(src);src.src=background;bkg.loop=true;
el=cn("120");d.body.insertBefore(bkg,el); var ht=cn("1"),gl=el.getContext("webgl"),ctx=0;
var iID = setInterval(drawScene, 40); var lines=80; var index=msgs.length;var minline=lines*0.395;var p=0.0;var cnv={};
function drawText(str, size, fnt, color, x, y) {ctx.font = size + 'px "'+fnt+'"'; ctx.textBaseline = 'top';ctx.fillStyle = color;ctx.fillText(str, x, y);}
function drawCircle(x,y,size,color){ ctx.beginPath();ctx.fillStyle=color;ctx.arc(el.width*0.5+x,el.height*0.8+y,size,0,Math.PI*2.0);ctx.fill();}
function rsz(){el.style.backgroundColor="#fff";tc.width = el.width = document.documentElement.clientWidth; tc.height = el.height = document.documentElement.clientHeight;gl.viewport(0, 0, el.width, el.height);ctx = tc.getContext("2d"); ctx.fillStyle="#3b3b3b";ctx.fillRect(0,0,el.width,el.height);widgets(ctx);drawScene();}rsz();document.onload = rsz;window.ondeviceorientation = rsz;window.onresize=rsz;
gl.clearColor(0.0, 0.0, 0.0, 1); gl.clear(gl.COLOR_BUFFER_BIT);function sh(g, t, x) {r = g.createShader(t);g.shaderSource(r, x);g.compileShader(r);return r;};vs = sh(gl, gl.VERTEX_SHADER, s[0]); fs = sh(gl, gl.FRAGMENT_SHADER, s[1]);
var glpr=gl.createProgram();gl.attachShader(glpr, vs);gl.attachShader(glpr, fs);gl.linkProgram(glpr);gl.useProgram(glpr);
var a=gl.getAttribLocation(glpr, "a"), buffer = gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER, buffer);gl.enableVertexAttribArray(a);gl.vertexAttribPointer(a, 3, gl.FLOAT, false, 0, 0);
gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]), gl.STATIC_DRAW);
function tprm(tex) {gl.bindTexture(gl.TEXTURE_2D, tex);gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);}
function teximg(tex, img) {gl.bindTexture(gl.TEXTURE_2D, tex);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, img);}
function unitex(tex, id, i, uni) {gl.activeTexture(id);gl.bindTexture(gl.TEXTURE_2D, tex);gl.uniform1i(gl.getUniformLocation(glpr, uni), i);}
var started = 0;var tx=[gl.createTexture(), gl.createTexture(), gl.createTexture()];for(var t in tx)tprm(tx[t]);
var pass=0;function drawScene() {if (started==0){ try{teximg(tx[0], tc); unitex(tx[0], gl.TEXTURE1, 1, "txt");gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4); } catch(e){console.log(e);}}
 else { try{ 
 	if (logtxt){
	var outp = logtxt.value.split("\n");outp.pop(); if (outp.length>msgs.length){index = outp.length;
	for (var m in outp){if (m==0) msgs[m] = " " + outp[m];else msgs[m] = "  " + (outp[m]);}  
	ctx = tc.getContext("2d"); ctx.fillStyle="#3b3b3b";ctx.fillRect(0,0,el.width,el.height);widgets(ctx); try{bkg.play();} catch(e){e.toString();}}}
	
 gl.uniform1f(gl.getUniformLocation(glpr, "pindex"), lines-index-1.5);
 gl.uniform1f(gl.getUniformLocation(glpr, "winr"), (el.height/el.width));
 teximg(tx[0], tc);teximg(tx[1],bkg);teximg(tx[2],cnv); 
 unitex(tx[0], gl.TEXTURE1, 1, "txt");unitex(tx[1], gl.TEXTURE2, 2, "bkg");unitex(tx[2], gl.TEXTURE3, 3, "cnv");
 gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);}catch(e){console.log(e);} }}

// APPLICATION	
var app = () =>  { var audio1=d.getElemenentById("audio1");var audio2=d.getElemenentById("audio2");audio1.play();
 started = 1; cnv=d.getElementById('canvas'); ctx = tc.getContext("2d"); ctx.fillStyle="#3b3b3b";ctx.fillRect(0,0,el.width,el.height);widgets(ctx); bkg.play();
el.ontouchstart = function(e){ cnv=d.getElementById('canvas'); if (e.changedTouches)e.preventDefault();
ix=((e.changedTouches[0].pageY/el.height)*lines)>>0;
if (ix<=msgs.length)index = ix; if (index<1)index=1;  rsz();};
el.onclick = function(e){ix=(((e.pageY/el.height)*lines)>>0)-2;if (ix<=msgs.length)index=ix;if (index<1)index=1; rsz();};}

   // LOADER
   el.ontouchstart = app;
   el.onclick = app;     
   
   /*strmouse = ["mousemove", "mousedown", "mouseup", "click"];
   for(var n in strmouse)
el.addEventListener(strmouse[n] , (e)=>{cnv=d.getElementById('canvas');
evt = document.createEvent("MouseEvents");
  evt.initMouseEvent(strmouse[n], true, true, window,
    0,0,0, (e.clientX/el.width)*cnv.width, (e.clientY/el.height)*cnv.height, false, false, false, false, 0, null);
  cnv.dispatchEvent(evt); });*/
   
function widgets(ctx){var fsize=el.height/lines;
try{
//list
var ty=1.5;

if (started==0){
  for (var m in loader){drawText(loader[m], fsize, "nrm","#eee",30,ty++*(fsize)); if (ty==1.5)ty=2.;}
}else{                      
		for(var m in msgs)
		drawText(msgs[m], fsize, "nrm","#eee",30,ty++*(fsize)); if (ty==1.5)ty=2.;
		
}
//label
var ttle=window.orientation ? 20 : 30;
var subt=window.orientation ? 10  : 15;
  ctx.beginPath();  ctx.strokeStyle="#eee";  ctx.lineWidth=1;
  ctx.moveTo(0,el.height*0.67);ctx.lineTo(el.width,el.height*0.67);
  ctx.closePath();  ctx.stroke();
  drawText("Whole (32 bits)",ttle , "nrm", "#eee", 10, tc.height*0.66-ttle);
if(started)
  drawText(msgs[index-1].substring(1), subt, "nrm", "#eee", 20, tc.height*0.675);
//media keys
var btnsize=window.orientation ? 40:60, clr="#aaa",clz="#999";
  //right
//  drawCircle(btnsize*2,0,btnsize+btnsize/10,clr);drawCircle(btnsize*2,0,btnsize,clz);
  //left
//  drawCircle(0-btnsize*2,0,btnsize+btnsize/10,clr);drawCircle(0-btnsize*2,0,btnsize,clz);
  //center
//  drawCircle(0,0,btnsize*1.3+btnsize/10,clr);drawCircle(0,0,btnsize*1.3,clz);
}catch(e){e.toString();}
}

</script>
<audio id="audio1" src="oOne.flac"></audio>
<audio id="audio2" src="oTwo.flac"/></audio>

<!-- Wine Windows Emulation in your browser  -->

	<div id="loading" style="display:none">
      <figure style="overflow:visible;" id="spinner"><div class="spinner"></div><center style="margin-top:0.5em"></center></figure>
      <div class="emscripten" id="status">Downloading...</div>
      <div class="emscripten">
          <progress value="0" max="100" id="progress" hidden=1></progress>
      </div>
  </div>
    <div id="run-inline" style="display: none">
        <button id="inline-runbtn" onclick="startInline()">inline</button>
    </div>

    <div id="inline" style="display:none">
        <div class="emscripten">
            <button id="startbtn" style="display: none" onclick="start()">Start</button>
            <button id="uploadbtn" style="display: none" onclick="document.getElementById('upload').click()" >Add File(s)</button>
            <input style="display: none" id="upload" name="upload" onclick="document.getElementById('uploadbtn').click();" onchange="startWithFiles(event.target.files);"  type="file" multiple />
            <button id="downloadbtn" style="display: none" onclick="buildTree();">Get File(s)</button>
            <a style="display: none" id="modalLink" href="#openModal">Download file >>></a>
            <a style="display: none" id="modalLinkExe" href="#openModalExe">Open</a>

          <span id="sound-checkbox" style="display: none">
              <input type="checkbox" id="soundToggle" onclick="toggleSound();">Enable Sound</input>
          </span>
          <input type="checkbox" id="pointerLock" checked>Lock/hide mouse pointer
          <input type="checkbox" id="showConsole" onclick="toggleConsole();" checked>Show console
          &nbsp;&nbsp;&nbsp;
          <input type="checkbox" id="resize">Resize canvas
          <input type="button" value="Fullscreen" onclick="Module.requestFullScreen(document.getElementById('pointerLock').checked, document.getElementById('resize').checked)">
        </div>
        <div id="dropzone" >
            <div class="emscripten_border">
                <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()"></canvas>
            </div>
        </div>
        <div>
            <textarea class="emscripten" id="output" rows="8" style="display: none"></textarea>
          <br/><a href="#" style="display:none" id='mp3btn'>Click to download the original MP3 file.</a>
        </div>
        <div id="openModal" class="modalDialog">
            <div> <a href="#close" title="Close" class="close" onclick="done();">X</a>
                <div>
                    <h3>Get File(s)</h3>
                    <input id="selectedItem" type="text" size="50" readonly>
                    <button onclick="extract();">Get</button>
                </div>
                <div id="tree">
                </div>
                <div>
                    <h3 id="loadStatus">Loading...</h3>
                </div>
            </div>
        </div>
        <div id="openModalExe" class="modalDialog">
            <div> <a id="openModalExeClick" href="#close" title="Close" class="close">X</a>
                <div>
                    <h3>Execute</h3>
                    <div id="message"></div>
                    <div id="items"></div>
                </div>
            </div>
        </div>
        
    </div>
	
    
        <script type="text/javascript" src="browserfs.min.js"></script>
        <script type="text/javascript" src="jszip.min.js"></script>
        <script type="text/javascript" src="boxedwine-shell.js"></script>
        <script>
		var logtxt=document.getElementById("output");
		
        function startInline() {
            document.getElementById('run-inline').style.display = 'none';
            document.getElementById('loading').style.display = '';
            Config.isRunningInline = true;
            Config.showUploadDownload = true;
            Config.urlParams = "p=notepad";
            var script = document.createElement('script');
            script.src = "boxedwine.js";
            document.body.appendChild(script);
        }
          document.getElementById('mp3btn').onclick= function(event){
        	try{var contents = FS.readFile(Config.dirPrefix+"/hello.mp3",   { encoding: 'binary' });
 
          blob = new Blob([contents], {type: "octet/stream"}),
          url = window.URL.createObjectURL(blob);
  	      this.href = url;
          this.target = '_blank';
  	      // target filename
            this.download="hello.mp3";}catch(ex){alert(ex.toString());}
          }
        </script>
<script async type="text/javascript" src="boxedwine.js"></script> 

</body>



